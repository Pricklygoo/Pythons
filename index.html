<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PYTHONS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #121212;
            color: #E0E0E0;
            overflow: hidden;
            touch-action: none;
        }
        .pixelated {
            image-rendering: pixelated;
        }
        .neon-text {
            text-shadow:
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 20px #0fa,
                0 0 30px #0fa,
                0 0 40px #0fa,
                0 0 55px #0fa,
                0 0 75px #0fa;
        }
        .control-card {
            background-color: rgba(30, 30, 30, 0.8);
            border: 2px solid #0fa;
            box-shadow: 0 0 15px #0fa;
        }
        canvas {
            background-color: #000;
            border: 4px solid #444;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .btn-primary {
            background-color: #0fa;
            color: #121212;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px #0fa;
        }
        .btn-primary:hover {
            background-color: #fff;
            color: #0fa;
            transform: scale(1.05);
            box-shadow: 0 0 20px #0fa;
        }
        .player-score {
            transition: all 0.3s ease;
            text-shadow: 0 0 5px currentColor;
        }
        .player-score.highlight {
            transform: scale(1.2);
            filter: brightness(1.5);
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div id="container" class="w-full h-screen flex flex-col items-center justify-center p-4">

        <!-- Menu Screen -->
        <div id="menu-screen" class="hidden text-center">
            <h1 class="text-6xl md:text-8xl font-bold mb-8 neon-text">PYTHONS</h1>
            <h2 class="text-2xl md:text-3xl mb-12">MULTIPLAYER</h2>

            <div class="mb-8">
                <h3 class="text-xl mb-4">Select Number of Players</h3>
                <div id="player-count-selector" class="flex justify-center gap-4">
                    <button data-players="2" class="player-option text-2xl py-3 px-6 rounded-lg border-2 border-gray-600 focus:border-green-400 focus:bg-green-900 focus:outline-none transition">2</button>
                    <button data-players="3" class="player-option text-2xl py-3 px-6 rounded-lg border-2 border-gray-600 focus:border-green-400 focus:bg-green-900 focus:outline-none transition">3</button>
                    <button data-players="4" class="player-option text-2xl py-3 px-6 rounded-lg border-2 border-gray-600 focus:border-green-400 focus:bg-green-900 focus:outline-none transition">4</button>
                </div>
            </div>

            <div class="mb-8 max-w-md mx-auto">
                <h3 class="text-xl mb-4">Score to Win: <span id="score-display">30</span></h3>
                <input id="score-slider" type="range" min="10" max="80" value="30" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
            </div>

            <button id="start-game-btn" class="btn-primary text-3xl font-bold py-4 px-10 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Start Game
            </button>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-12 max-w-6xl mx-auto">
                <!-- Player 1 Controls -->
                <div class="control-card p-4 rounded-lg">
                    <h4 class="text-lg mb-2" style="color: #34D399;">Player 1</h4>
                    <p>WASD Keys</p>
                </div>
                <!-- Player 2 Controls -->
                <div class="control-card p-4 rounded-lg">
                    <h4 class="text-lg mb-2" style="color: #F87171;">Player 2</h4>
                    <p>IJKL Keys</p>
                </div>
                <!-- Player 3 Controls -->
                <div class="control-card p-4 rounded-lg">
                    <h4 class="text-lg mb-2" style="color: #60A5FA;">Player 3</h4>
                    <p>Arrow Keys</p>
                </div>
                <!-- Player 4 Controls -->
                <div class="control-card p-4 rounded-lg">
                    <h4 class="text-lg mb-2" style="color: #FBBF24;">Player 4</h4>
                    <p>Numpad 8456</p>
                </div>
            </div>
             <p class="mt-8 text-sm text-gray-400">First to the selected score wins! Wall hits reset score. Player hits lose 5 points.</p>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden w-full h-full flex-col items-center">
            <div id="scoreboard" class="flex justify-around mb-2 text-2xl font-bold w-full max-w-6xl"></div>
            <canvas id="game-canvas"></canvas>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="hidden text-center">
            <h1 id="winner-text" class="text-5xl md:text-7xl font-bold mb-8 neon-text"></h1>
            <button id="play-again-btn" class="btn-primary text-2xl font-bold py-4 px-8 rounded-xl">Play Again</button>
        </div>
        
        <!-- Pause Menu Screen -->
        <div id="pause-screen" class="hidden overlay">
            <div class="text-center bg-gray-800 p-10 rounded-lg shadow-lg border-2 border-gray-600">
                <h1 class="text-5xl mb-8 neon-text">Paused</h1>
                <div class="flex flex-col gap-4">
                     <button id="restart-btn" class="btn-primary text-2xl font-bold py-3 px-8 rounded-xl">Restart</button>
                     <button id="exit-btn" class="btn-primary text-2xl font-bold py-3 px-8 rounded-xl">Exit to Menu</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const menuScreen = document.getElementById('menu-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const pauseScreen = document.getElementById('pause-screen');
        const playerCountSelector = document.getElementById('player-count-selector');
        const startGameBtn = document.getElementById('start-game-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const restartBtn = document.getElementById('restart-btn');
        const exitBtn = document.getElementById('exit-btn');
        const scoreSlider = document.getElementById('score-slider');
        const scoreDisplay = document.getElementById('score-display');
        const scoreboard = document.getElementById('scoreboard');
        const winnerText = document.getElementById('winnerText');
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        // --- Game Configuration ---
        const TILE_SIZE = 20;
        let winningScore = 30;
        const GAME_SPEED = 120; // in milliseconds

        let tileCountX, tileCountY;
        let players = [];
        let food = {};
        let playerCount = 0;
        let gameLoopInterval;
        let isPaused = false;

        const PLAYER_CONFIG = [
            { // Player 1
                color: '#34D399', // Green
                controls: { 'KeyW': 'up', 'KeyS': 'down', 'KeyA': 'left', 'KeyD': 'right' },
            },
            { // Player 2
                color: '#F87171', // Red
                controls: { 'KeyI': 'up', 'KeyK': 'down', 'KeyJ': 'left', 'KeyL': 'right' },
            },
            { // Player 3
                color: '#60A5FA', // Blue
                controls: { 'ArrowUp': 'up', 'ArrowDown': 'down', 'ArrowLeft': 'left', 'ArrowRight': 'right' },
            },
            { // Player 4
                color: '#FBBF24', // Amber
                controls: { 'Numpad8': 'up', 'Numpad5': 'down', 'Numpad4': 'left', 'Numpad6': 'right' },
            },
        ];
        
        window.onload = () => {
            menuScreen.classList.remove('hidden');
        };


        // --- Event Listeners ---
        window.addEventListener('resize', setupCanvas);

        playerCountSelector.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('.player-option').forEach(btn => btn.classList.remove('bg-green-700'));
                e.target.classList.add('bg-green-700');
                playerCount = parseInt(e.target.dataset.players);
                startGameBtn.disabled = false;
            }
        });

        scoreSlider.addEventListener('input', (e) => {
            winningScore = parseInt(e.target.value);
            scoreDisplay.textContent = winningScore;
        });

        startGameBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', () => {
            gameOverScreen.classList.add('hidden');
            menuScreen.classList.remove('hidden');
        });
        
        restartBtn.addEventListener('click', () => {
            pauseScreen.classList.add('hidden');
            isPaused = false;
            startGame();
        });

        exitBtn.addEventListener('click', () => {
            pauseScreen.classList.add('hidden');
            isPaused = false;
            if (gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = null;
            gameScreen.classList.add('hidden');
            menuScreen.classList.remove('hidden');
        });

        document.addEventListener('keydown', handleKeyPress);
        
        // --- Game Setup ---
        function setupCanvas() {
            const scoreboardHeight = scoreboard.offsetHeight;
            const container = document.getElementById('container');
            const availableWidth = container.clientWidth * 0.9;
            const availableHeight = (window.innerHeight - scoreboardHeight) * 0.9;

            tileCountX = Math.floor(availableWidth / TILE_SIZE);
            tileCountY = Math.floor(availableHeight / TILE_SIZE);
            
            canvas.width = tileCountX * TILE_SIZE;
            canvas.height = tileCountY * TILE_SIZE;

            if (gameLoopInterval) {
                drawGame();
            }
        }

        function createPlayer(id) {
            const config = PLAYER_CONFIG[id-1];
            let startPos;
            
            switch(id) {
                case 1: startPos = { x: 3, y: 3 }; break;
                case 2: startPos = { x: tileCountX - 4, y: 3 }; break;
                case 3: startPos = { x: 3, y: tileCountY - 4 }; break;
                case 4: startPos = { x: tileCountX - 4, y: tileCountY - 4 }; break;
            }

            return {
                id: id,
                snake: [startPos],
                direction: 'none',
                nextDirection: 'none',
                score: 0,
                isAlive: true,
                ...config
            };
        }

        function resetPlayer(player, collisionType) {
            let startPos;
            switch(player.id) {
                case 1: startPos = { x: 3, y: 3 }; break;
                case 2: startPos = { x: tileCountX - 4, y: 3 }; break;
                case 3: startPos = { x: 3, y: tileCountY - 4 }; break;
                case 4: startPos = { x: tileCountX - 4, y: tileCountY - 4 }; break;
            }
            player.snake = [startPos];
            player.direction = 'none';
            player.nextDirection = 'none';

            if (collisionType === 'wall' || collisionType === 'self') {
                player.score = 0;
            } else if (collisionType === 'player') {
                player.score = Math.max(0, player.score - 5);
            }
            updateScoreboard();
        }

        // --- Game Start/End ---
        function startGame() {
            menuScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex');

            setupCanvas();
            
            winningScore = parseInt(scoreSlider.value);
            players = [];
            for (let i = 1; i <= playerCount; i++) {
                players.push(createPlayer(i));
            }
            
            updateScoreboard();
            generateFood();
            
            if (gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, GAME_SPEED);
        }

        function endGame(winner) {
            clearInterval(gameLoopInterval);
            gameLoopInterval = null;
            winnerText.textContent = `Player ${winner.id} Wins!`;
            winnerText.style.color = winner.color;
            gameScreen.classList.add('hidden');
            gameScreen.classList.remove('flex');
            gameOverScreen.classList.remove('hidden');
        }
        
        function togglePause() {
            if (!gameLoopInterval && !isPaused) return;

            isPaused = !isPaused;
            if (isPaused) {
                clearInterval(gameLoopInterval);
                gameLoopInterval = null;
                pauseScreen.classList.remove('hidden');
            } 
        }

        // --- Game Loop ---
        function gameLoop() {
            updateGameState();
            drawGame();
        }

        function updateGameState() {
            players.forEach(player => {
                if (!player.isAlive) return;

                if (player.nextDirection !== 'none') {
                    const isOpposite = (dir1, dir2) =>
                        (dir1 === 'up' && dir2 === 'down') ||
                        (dir1 === 'down' && dir2 === 'up') ||
                        (dir1 === 'left' && dir2 === 'right') ||
                        (dir1 === 'right' && dir2 === 'left');
                    
                    if (!isOpposite(player.direction, player.nextDirection)) {
                        player.direction = player.nextDirection;
                    }
                    player.nextDirection = 'none';
                }

                if (player.direction === 'none') return;

                const head = { ...player.snake[0] };
                switch (player.direction) {
                    case 'up': head.y--; break;
                    case 'down': head.y++; break;
                    case 'left': head.x--; break;
                    case 'right': head.x++; break;
                }

                const collisionType = checkCollision(head, player);
                if (collisionType) {
                    resetPlayer(player, collisionType);
                    return;
                }

                player.snake.unshift(head);

                if (head.x === food.x && head.y === food.y) {
                    player.score++;
                    updateScoreboard(player.id);
                    if (player.score >= winningScore) {
                        endGame(player);
                    } else {
                        generateFood();
                    }
                } else {
                    player.snake.pop();
                }
            });
        }
        
        // --- Collision Detection ---
        function checkCollision(head, currentPlayer) {
            if (head.x < 0 || head.x >= tileCountX || head.y < 0 || head.y >= tileCountY) {
                return 'wall';
            }

            for (let i = 1; i < currentPlayer.snake.length; i++) {
                if (head.x === currentPlayer.snake[i].x && head.y === currentPlayer.snake[i].y) {
                    return 'self';
                }
            }
            
            for (const otherPlayer of players) {
                if (otherPlayer.id === currentPlayer.id) continue;
                
                for (const segment of otherPlayer.snake) {
                    if (head.x === segment.x && head.y === segment.y) {
                        return 'player';
                    }
                }
            }

            return false;
        }

        // --- Food Logic ---
        function generateFood() {
            let newFoodPosition;
            let onSnake = true;
            while(onSnake) {
                newFoodPosition = {
                    x: Math.floor(Math.random() * tileCountX),
                    y: Math.floor(Math.random() * tileCountY),
                };
                
                onSnake = false;
                for (const player of players) {
                    for (const segment of player.snake) {
                        if (segment.x === newFoodPosition.x && segment.y === newFoodPosition.y) {
                            onSnake = true;
                            break;
                        }
                    }
                    if(onSnake) break;
                }
            }
            food = newFoodPosition;
        }

        // --- Drawing ---
        function drawGame() {
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#FFFFFF';
            ctx.shadowColor = '#FFFFFF';
            ctx.shadowBlur = 10;
            ctx.fillRect(food.x * TILE_SIZE, food.y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            ctx.shadowBlur = 0;

            players.forEach(player => {
                ctx.fillStyle = player.color;
                ctx.shadowColor = player.color;
                ctx.shadowBlur = 5;
                player.snake.forEach((segment, index) => {
                    ctx.globalAlpha = (index === 0) ? 1.0 : 0.8;
                    ctx.fillRect(segment.x * TILE_SIZE, segment.y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                });
            });
            ctx.globalAlpha = 1.0;
            ctx.shadowBlur = 0;
        }

        // --- UI Updates ---
        function updateScoreboard(highlightPlayerId = null) {
            scoreboard.innerHTML = '';
            players.forEach(player => {
                const scoreElement = document.createElement('div');
                scoreElement.id = `player-${player.id}-score`;
                scoreElement.className = 'player-score p-2 rounded-md';
                scoreElement.style.color = player.color;
                scoreElement.textContent = `P${player.id}: ${player.score}`;
                scoreboard.appendChild(scoreElement);

                if (player.id === highlightPlayerId) {
                    scoreElement.classList.add('highlight');
                    setTimeout(() => scoreElement.classList.remove('highlight'), 300);
                }
            });
        }

        // --- Input Handling ---
        function handleKeyPress(e) {
            if (e.code === 'Escape') {
                e.preventDefault();
                togglePause();
                return;
            }

            if (!gameLoopInterval || isPaused) return;
            e.preventDefault();
            
            players.forEach(player => {
                if (player.controls[e.code]) {
                    player.nextDirection = player.controls[e.code];
                }
            });
        }
    </script>

</body>
</html>

